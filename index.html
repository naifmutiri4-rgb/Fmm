<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>FMM Mass Control Advanced</title>
<style>
:root {
    --fmm-purple:#7c4dff;
    --bg:#050505;
    --card:#111114;
    --glass:rgba(20,20,25,0.95);
    --safe-top:env(safe-area-inset-top);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:#fff;margin:0;font-family:-apple-system,sans-serif;padding-top:var(--safe-top);}
.fmm-nav{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #1a1a1a;position:sticky;top:0;background:var(--bg);z-index:100;}
.logo{font-weight:900;font-size:24px;color:var(--fmm-purple);}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:20px 15px;}
.s-card{background:var(--card);padding:12px 5px;border-radius:12px;text-align:center;border:1px solid #1f1f23;}
.s-card span{display:block;font-size:8px;color:#555;margin-bottom:4px;}
.s-card b{font-size:11px;color:var(--fmm-purple);}
.control-bar{padding:0 15px 15px;display:flex;justify-content:space-between;align-items:center;}
.batch-btn{background:#00e676;color:#000;border:none;padding:8px 15px;border-radius:10px;font-weight:bold;font-size:12px;display:none;}
.section-label{padding:10px 20px;font-size:12px;color:#444;font-weight:bold;background:#08080a;}
.list{padding:0 15px 20px;min-height:40px;}
.order{background:var(--card);margin-bottom:10px;padding:15px;border-radius:18px;border:1px solid #1f1f23;position:relative;transition:0.3s;}
.order.selected{border-color:var(--fmm-purple);background:rgba(124,77,255,0.05);}
.order-check{position:absolute;left:15px;top:15px;transform:scale(1.3);}
.order-info b{font-size:14px;display:block;margin-bottom:5px;}
.order-info small{color:#555;font-size:10px;}
.glass{position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(20px);z-index:1000;display:none;align-items:flex-end;}
.glass.active{display:flex;}
.sheet{background:var(--glass);width:100%;border-radius:35px 35px 0 0;padding:30px 20px 40px;border-top:1px solid var(--fmm-purple);}
.btn-full{width:100%;padding:16px;border-radius:15px;border:none;font-weight:bold;font-size:15px;margin-top:10px;cursor:pointer;}
.btn-primary{background:var(--fmm-purple);color:#fff;}
.rec-option{padding:10px;border-radius:12px;border:1px solid #333;margin:8px 0;cursor:pointer;}
.rec-option.active{border-color:var(--fmm-purple);background:rgba(124,77,255,0.1);}
.total-box{background:rgba(255,255,255,0.03);padding:15px;border-radius:20px;text-align:center;margin-bottom:15px;}
.total-box small{font-size:12px;color:#aaa;}
.total-box b{font-size:24px;color:#00e676;font-weight:900;}
</style>
</head>
<body>

<nav class="fmm-nav">
    <div class="logo">FMM</div>
    <div style="font-size:24px;">â˜°</div>
</nav>

<div class="stats-grid">
    <div class="s-card"><span>Ø§Ù„Ø±ØµÙŠØ¯</span><b id="bal">$2,500.00</b></div>
    <div class="s-card"><span>Ø§Ù†ØªØ¸Ø§Ø±</span><b id="c-p">3</b></div>
    <div class="s-card"><span>ØªÙ†ÙÙŠØ°</span><b id="c-r">0</b></div>
    <div class="s-card"><span>Ù…ÙƒØªÙ…Ù„</span><b id="c-d">0</b></div>
</div>

<div class="control-bar">
    <label style="font-size:12px;color:#888;"><input type="checkbox" id="selectAll" onclick="toggleAll()"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</label>
    <button id="batchBtn" class="batch-btn" onclick="openMassModal()">ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø®ØªØ§Ø± ( <span id="selCount">0</span> ) âš¡</button>
</div>

<div class="section-label">ğŸ“¦ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
<div id="pending-list" class="list"></div>

<div class="section-label">â³ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
<div id="processing-list" class="list"></div>

<div class="section-label">âœ… Ù…ÙƒØªÙ…Ù„</div>
<div id="completed-list" class="list"></div>

<div class="glass" id="modal">
    <div class="sheet" id="modalContent"></div>
</div>

<script>
let data = {
    balance:2500,
    pending:[
        {id:101,user:"Ù†Ø§ÙŠÙ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ",service:"Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ",qty:"2K",cost:2.2},
        {id:102,user:"Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯",service:"Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ",qty:"1K",cost:1.2},
        {id:103,user:"Ù…ØªØ¬Ø± Ø§Ù„Ø±ÙˆØ§Ø¯",service:"Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ",qty:"5K",cost:5.0}
    ],
    processing:[],
    completed:[],
    selectedIds:[]
};

let services=[
    {name:"Ø¨Ø§ÙƒØ¬#1 - 100 Ù…ØªØ§Ø¨Ø¹","time":"0-24 Ø³Ø§Ø¹Ø©","cost":40.02,"desc":"Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©/Ø­ØµØ±ÙŠØ© - Ø§Ù„Ø£Ø³Ø±Ø¹, Ø¬ÙˆØ¯Ø© +90%, Ù„Ø§ Ø¶Ù…Ø§Ù†"},
    {name:"Ø¨Ø§ÙƒØ¬#2 - 200 Ù…ØªØ§Ø¨Ø¹","time":"1-48 Ø³Ø§Ø¹Ø©","cost":70.0,"desc":"Ø¬ÙˆØ¯Ø© +95%, Ø¶Ù…Ø§Ù† 50%"},
    {name:"Ø¨Ø§ÙƒØ¬#3 - 500 Ù…ØªØ§Ø¨Ø¹","time":"2-72 Ø³Ø§Ø¹Ø©","cost":150.0,"desc":"Ø£ÙØ¶Ù„ Ø¬ÙˆØ¯Ø©, Ø¶Ù…Ø§Ù† ÙƒØ§Ù…Ù„"}
];

let selectedServices={};

function render(){
    const pList=document.getElementById('pending-list');
    pList.innerHTML=data.pending.map(o=>`
        <div class="order ${data.selectedIds.includes(o.id)?'selected':''}" onclick="toggleSelect(${o.id})">
            <input type="checkbox" class="order-check" ${data.selectedIds.includes(o.id)?'checked':''}>
            <div class="order-info">
                <b>#${o.id} | ${o.user}</b>
                <small>${o.service} â€¢ Ø§Ù„ÙƒÙ…ÙŠØ©: ${o.qty} â€¢ Ø§Ù„ØªÙƒÙ„ÙØ©: $${o.cost}</small>
            </div>
        </div>
    `).join('');

    document.getElementById('processing-list').innerHTML=data.processing.map(o=>`
        <div class="order" style="border-right:3px solid #ffcf4b;">
            <b>#${o.id}</b> <small style="color:#ffcf4b;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</small>
        </div>
    `).join('');

    document.getElementById('completed-list').innerHTML=data.completed.map(o=>`
        <div class="order" style="opacity:0.5;border-right:3px solid #00e676;">
            <b>#${o.id}</b> <small style="color:#00e676;">Ø§ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</small>
        </div>
    `).join('');

    document.getElementById('c-p').innerText=data.pending.length;
    document.getElementById('c-r').innerText=data.processing.length;
    document.getElementById('c-d').innerText=data.completed.length;
    document.getElementById('bal').innerText=`$${data.balance.toFixed(2)}`;

    const btn=document.getElementById('batchBtn');
    btn.style.display=data.selectedIds.length>0?'block':'none';
    document.getElementById('selCount').innerText=data.selectedIds.length;
}

function toggleSelect(id){
    if(data.selectedIds.includes(id)) data.selectedIds=data.selectedIds.filter(i=>i!==id);
    else data.selectedIds.push(id);
    render();
}

function toggleAll(){
    if(data.selectedIds.length===data.pending.length) data.selectedIds=[];
    else data.selectedIds=data.pending.map(o=>o.id);
    render();
}

function openMassModal(){
    const ids=[...data.selectedIds];
    if(ids.length===0) return;

    let html='';
    ids.forEach((id,index)=>{
        const order=data.pending.find(o=>o.id===id);
        html+=`
            <div style="margin-bottom:20px;">
                <h3 style="color:var(--fmm-purple); margin:0;">${order.user} | ${order.service} | ${order.qty}</h3>
                <p style="font-size:12px;color:#888;">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§ÙƒØ¬ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨:</p>
                ${services.map((s,i)=>`<div class="rec-option ${i===0?'active':''}" onclick="selectService(${id},${i})" id="svc-${id}-${i}">
                    <b>${s.name}</b> | Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: ${s.time} | Ø§Ù„Ø³Ø¹Ø±: ${s.cost} SAR
                    <div style="font-size:10px;color:#aaa;">${s.desc}</div>
                </div>`).join('')}
            </div>
        `;

        selectedServices[id]=0; // Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø§ÙƒØ¬#1
    });

    html+=`<div class="total-box">
        <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©:</small>
        <b id="totalCost">0</b> SAR
    </div>`;
    html+=`<button class="btn-full btn-primary" onclick="confirmMass()">ØªØ£ÙƒÙŠØ¯ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙ„ âœ…</button>
           <button class="btn-full" style="background:none;border:1px solid #333;" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>`;

    document.getElementById('modalContent').innerHTML=html;
    document.getElementById('modal').classList.add('active');
    updateTotalCost();
}

function selectService(orderId,svcIndex){
    selectedServices[orderId]=svcIndex;
    document.querySelectorAll(`#modalContent .rec-option`).forEach(el=>el.classList.remove('active'));
    document.getElementById(`svc-${orderId}-${svcIndex}`).classList.add('active');
    updateTotalCost();
}

function updateTotalCost(){
    let total=0;
    Object.keys(selectedServices).forEach(id=>{
        total+=services[selectedServices[id]].cost;
    });
    document.getElementById('totalCost').innerText=total.toFixed(2);
}

function confirmMass(){
    Object.keys(selectedServices).forEach(id=>{
        const idx=data.pending.findIndex(o=>o.id==id);
        if(idx>-1){
            const order=data.pending.splice(idx,1)[0];
            const svcIdx=selectedServices[id];
            const svc=services[svcIdx];
            data.balance-=svc.cost;
            order.serviceChosen=svcIdx;
            data.processing.push(order);
            setTimeout(()=>{
                const pIdx=data.processing.findIndex(x=>x.id==id);
                if(pIdx>-1){
                    const done=data.processing.splice(pIdx,1)[0];
                    data.completed.unshift(done);
                    render();
                }
            },5000);
        }
    });
    selectedServices={};
    data.selectedIds=[];
    render();
    closeModal();
}

function closeModal(){document.getElementById('modal').classList.remove('active');}

window.onload=render;
</script>
</body>
</html>

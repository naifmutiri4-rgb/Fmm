<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FMM Mass Control Full</title>
<style>
:root {
    --fmm-purple: #7c4dff;
    --bg: #050505;
    --card: #111114;
    --glass: rgba(20,20,25,0.95);
}
body { margin:0; padding:env(safe-area-inset-top); background:var(--bg); color:#fff; font-family:-apple-system,sans-serif; }
.fmm-nav { padding:15px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #1a1a1a; position:sticky; top:0; background:var(--bg); z-index:100; }
.logo { font-weight:900; font-size:24px; color:var(--fmm-purple); }

.stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:20px 15px; }
.s-card { background:var(--card); padding:12px 5px; border-radius:12px; text-align:center; border:1px solid #1f1f23; }
.s-card span{display:block;font-size:8px;color:#555;margin-bottom:4px;}
.s-card b{font-size:11px;color:var(--fmm-purple);}

.control-bar{padding:0 15px 15px; display:flex; justify-content:space-between; align-items:center;}
.batch-btn{background:#00e676;color:#000;border:none;padding:8px 15px;border-radius:10px;font-weight:bold;font-size:12px; display:none;}

.section-label{padding:10px 20px; font-size:12px; color:#444; font-weight:bold; background:#08080a;}
.list{padding:0 15px 20px; min-height:40px;}

.order{background:var(--card); margin-bottom:10px; padding:15px; border-radius:18px; border:1px solid #1f1f23; position:relative; transition:.3s;}
.order.selected{border-color:var(--fmm-purple); background:rgba(124,77,255,0.05);}
.order-check{position:absolute; left:15px; top:15px; transform:scale(1.3);}
.order-info b{font-size:14px; display:block; margin-bottom:5px;}
.order-info small{color:#555; font-size:10px;}

.glass{position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(20px); z-index:1000; display:none; align-items:flex-end;}
.glass.active{display:flex;}
.sheet{background:var(--glass); width:100%; border-radius:35px 35px 0 0; padding:30px 20px 40px; border-top:1px solid var(--fmm-purple);}

.btn-full{width:100%; padding:16px; border-radius:15px; border:none; font-weight:bold; font-size:15px; margin-top:10px; cursor:pointer;}
.btn-primary{background:var(--fmm-purple); color:#fff;}
.service-card{padding:10px; border-radius:12px; background:#222; margin:5px 0; cursor:pointer; border:1px solid #333;}
.service-card.selected{border:2px solid #00e676; background:rgba(0,230,118,0.1);}
</style>
</head>
<body>

<nav class="fmm-nav"><div class="logo">FMM</div><div style="font-size:24px;">â˜°</div></nav>

<div class="stats-grid">
<div class="s-card"><span>Ø§Ù„Ø±ØµÙŠØ¯</span><b id="bal">$2,500.00</b></div>
<div class="s-card"><span>Ø§Ù†ØªØ¸Ø§Ø±</span><b id="c-p">3</b></div>
<div class="s-card"><span>ØªÙ†ÙÙŠØ°</span><b id="c-r">0</b></div>
<div class="s-card"><span>Ù…ÙƒØªÙ…Ù„</span><b id="c-d">0</b></div>
</div>

<div class="control-bar">
<label style="font-size:12px;color:#888;"><input type="checkbox" id="selectAll" onclick="toggleAll()"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</label>
<button id="batchBtn" class="batch-btn" onclick="openMassModal()">ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø®ØªØ§Ø± (<span id="selCount">0</span>) âš¡</button>
</div>

<div class="section-label">ğŸ“¦ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
<div id="pending-list" class="list"></div>

<div class="section-label">â³ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° (Ù…ØªØ¹Ø¯Ø¯)</div>
<div id="processing-list" class="list"></div>

<div class="section-label">âœ… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØªÙ…Ù„</div>
<div id="completed-list" class="list"></div>

<div class="glass" id="modal">
<div class="sheet" id="modalContent"></div>
</div>

<script>
let data = {
    balance:2500.0,
    pending:[
        {id:101,user:"Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ",cost:1.2},
        {id:102,user:"Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯",cost:2.5},
        {id:103,user:"Ù…ØªØ¬Ø± Ø§Ù„Ø±ÙˆØ§Ø¯",cost:5.0}
    ],
    processing:[],
    completed:[],
    selectedIds:[],
    services:[
        {id:1,name:"#6838 | Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ | Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: 2h | 4.5 Ø±ÙŠØ§Ù„"},
        {id:2,name:"#6839 | Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ | Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: 3h | 4.0 Ø±ÙŠØ§Ù„"},
        {id:3,name:"#6840 | Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ | Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: 1h | 5.0 Ø±ÙŠØ§Ù„"}
    ],
    selectedService:{}
};

function render(){
    const pList = document.getElementById('pending-list');
    pList.innerHTML = data.pending.map(o=>`
    <div class="order ${data.selectedIds.includes(o.id)?'selected':''}" onclick="toggleSelect(${o.id})">
        <input type="checkbox" class="order-check" ${data.selectedIds.includes(o.id)?'checked':''}>
        <div class="order-info">
            <b>#${o.id} | ${o.user}</b>
            <small>Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ØªÙŠÙƒ ØªÙˆÙƒ â€¢ Ø§Ù„ØªÙƒÙ„ÙØ©: $${o.cost}</small>
        </div>
    </div>`).join('');

    document.getElementById('processing-list').innerHTML = data.processing.map(o=>`
        <div class="order" style="border-right:3px solid #ffcf4b;">
            <b>#${o.id}</b> <small style="color:#ffcf4b;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</small>
        </div>`).join('');

    document.getElementById('completed-list').innerHTML = data.completed.map(o=>`
        <div class="order" style="opacity:0.5; border-right:3px solid #00e676;">
            <b>#${o.id}</b> <small style="color:#00e676;">Ø§ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</small>
        </div>`).join('');

    document.getElementById('c-p').innerText = data.pending.length;
    document.getElementById('c-r').innerText = data.processing.length;
    document.getElementById('c-d').innerText = data.completed.length;
    document.getElementById('bal').innerText = `$${data.balance.toFixed(2)}`;

    const btn = document.getElementById('batchBtn');
    btn.style.display = data.selectedIds.length>0?'block':'none';
    document.getElementById('selCount').innerText = data.selectedIds.length;
}

function toggleSelect(id){
    if(data.selectedIds.includes(id)) data.selectedIds = data.selectedIds.filter(i=>i!==id);
    else data.selectedIds.push(id);
    render();
}

function toggleAll(){
    if(data.selectedIds.length===data.pending.length) data.selectedIds=[];
    else data.selectedIds = data.pending.map(o=>o.id);
    render();
}

function openMassModal(){
    let modalHTML=`<h2 style="color:var(--fmm-purple); margin:0;">ğŸš€ ØªÙ†ÙÙŠØ° Ø¬Ù…Ø§Ø¹ÙŠ</h2>
    <p style="color:#888; font-size:12px; margin:15px 0;">Ø£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ ØªÙ†ÙÙŠØ° ${data.selectedIds.length} Ø·Ù„Ø¨Ø§Øª.</p>`;

    data.selectedIds.forEach(id=>{
        const order = data.pending.find(o=>o.id===id);
        modalHTML+=`<div style="margin:10px 0;"><b>#${order.id} | ${order.user}</b></div>`;
        modalHTML+=`<div>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© Ù„ÙƒÙ„ Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· "Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ":</div>`;
        modalHTML+=`<button class="btn-full" style="margin:5px 0;" onclick="autoSelect(${id})">Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ âœ…</button>`;
        modalHTML+=data.services.map(s=>`<div class="service-card" id="srv-${id}-${s.id}" onclick="selectService(${id},${s.id})">${s.name}</div>`).join('');
    });

    modalHTML+=`<button class="btn-full btn-primary" onclick="startMassExecution()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø²ÙˆØ¯ âœ…</button>
    <button class="btn-full" style="background:none;border:1px solid #333;" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>`;

    document.getElementById('modalContent').innerHTML = modalHTML;
    document.getElementById('modal').classList.add('active');
}

function closeModal(){document.getElementById('modal').classList.remove('active');}

function selectService(orderId,serviceId){
    data.selectedService[orderId]=serviceId;
    // ØªÙØ¹ÙŠÙ„ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    data.services.forEach(s=>{
        const el = document.getElementById(`srv-${orderId}-${s.id}`);
        if(el) el.classList.remove('selected');
    });
    const selEl=document.getElementById(`srv-${orderId}-${serviceId}`);
    if(selEl) selEl.classList.add('selected');
}

function autoSelect(orderId){
    // Ø§Ø®ØªÙŠØ§Ø± Ø£Ø±Ø®Øµ ÙˆØ£Ø³Ø±Ø¹
    let bestService = data.services[0];
    data.services.forEach(s=>{
        const sCost = parseFloat((s.name.match(/(\d+(\.\d+)?)/)||[0])[1]);
        const bestCost = parseFloat((bestService.name.match(/(\d+(\.\d+)?)/)||[0])[1]);
        if(sCost<bestCost) bestService=s;
    });
    selectService(orderId,bestService.id);
}

function startMassExecution(){
    const idsToExec=[...data.selectedIds];
    data.selectedIds=[];
    idsToExec.forEach(id=>{
        const idx = data.pending.findIndex(o=>o.id===id);
        if(idx>-1){
            const order = data.pending.splice(idx,1)[0];
            data.balance -= order.cost*1.1;
            const serviceId = data.selectedService[id]||data.services[0].id;
            order.serviceId=serviceId;
            data.processing.push(order);
            // Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ù…Ø³ØªÙ‚Ù„Ø© Ù„ÙƒÙ„ Ø·Ù„Ø¨
            setTimeout(()=>{
                const pIdx=data.processing.findIndex(x=>x.id===id);
                if(pIdx>-1){
                    const done=data.processing.splice(pIdx,1)[0];
                    data.completed.unshift(done);
                    render();
                }
            },5000);
        }
    });
    render();
    closeModal();
}

window.onload=render;
</script>
</body>
</html>
